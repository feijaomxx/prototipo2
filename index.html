<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Facilita - Sistema Integrado v2</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png"
        href="https://www.google.com/s2/favicons?domain=facilitafinanciamento.com.br&sz=64">
</head>

<body>

    <div id="loginScreen" class="login-overlay">
        <div class="login-box">
            <div class="brand-login"><i class="fa-solid fa-location-dot"></i> PORTAL FACILITA</div>
            <h3>Acesso ao Sistema</h3>
            <form id="formLogin" onsubmit="event.preventDefault(); fazerLoginManual();">
                <div class="input-group">
                    <label>Módulo de Acesso</label>
                    <select id="moduloSelect"
                        style="width:100%; padding:12px; border:2px solid #e0e0e0; border-radius:8px; margin-bottom:15px;">
                        <option value="vendas">Gestão de Vendas (Loja)</option>
                        <option value="mecanica">Gestão de Oficina (Mecânica)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Usuário (Ex: vendedor, gerente, financeiro)</label>
                    <input type="text" id="loginUser" required>
                </div>
                <div class="input-group">
                    <label>Senha</label>
                    <input type="password" id="loginPass" required>
                </div>
                <button type="submit" class="btn-login">ACESSAR SISTEMA</button>
            </form>
        </div>
    </div>

    <div id="appLayout" class="app-container" style="display: none;">

        <div class="mobile-overlay" id="mobileOverlay" onclick="toggleMenu()"></div>

        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="fa-solid fa-location-dot"></i> <span>FACILITA</span>
                <button class="close-menu-btn" onclick="toggleMenu()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="user-mini-profile">
                <img src="https://ui-avatars.com/api/?name=User+Test&background=fff&color=1e88e5" id="menuAvatar">
                <div class="u-info">
                    <strong id="menuUserNome">---</strong>
                    <small id="menuUserCargo">---</small>
                </div>
            </div>
            <nav class="menu-items" id="dynamicMenu">
            </nav>
            <button class="btn-sair" onclick="fazerLogout()">
                <i class="fa-solid fa-power-off"></i> Sair
            </button>
        </aside>

        <main class="content-wrapper">
            <header class="top-bar">
                <div class="left-top">
                    <button class="menu-toggle" onclick="toggleMenu()"><i class="fa-solid fa-bars"></i></button>
                    <h2 id="pageTitle">Visão Geral</h2>
                </div>
            </header>

            <section id="sec-home" class="page-section active">
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon blue"><i class="fa-solid fa-car"></i></div>
                        <div class="kpi-info">
                            <h3><span id="kpiVendasHoje">0</span></h3>
                            <p>Vendas Hoje</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon green"><i class="fa-solid fa-dollar-sign"></i></div>
                        <div class="kpi-info">
                            <h3>R$ <span id="kpiFaturamento">0k</span></h3>
                            <p>Faturamento Dia</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon orange"><i class="fa-solid fa-wrench"></i></div>
                        <div class="kpi-info">
                            <h3><span id="kpiOSPendentes">0</span></h3>
                            <p>OS em Aberto</p>
                        </div>
                    </div>
                </div>
                <div class="panel-box">
                    <h3>Ranking de Vendas (Hoje)</h3>
                    <div class="ranking-simple-list" id="listaRanking"></div>
                </div>
            </section>

            <section id="sec-estoque" class="page-section">
                <div class="panel-box">
                    <div class="panel-header">
                        <h3>Estoque Disponível</h3>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" placeholder="Buscar placa, modelo, chassi..." class="search-input"
                                onkeyup="filtrarEstoque(this.value)">
                            <select class="search-input" id="filtroDias" onchange="filtrarPorDias(this.value)"
                                style="width: 150px;">
                                <option value="todos">Todos os Dias</option>
                                <option value="antigos">+60 Dias (Antigos)</option>
                                <option value="recentes">-30 Dias (Novos)</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Veículo/Placa</th>
                                    <th>Cor/Combustível</th>
                                    <th>Chassi</th>
                                    <th>Ano (Fab/Mod)</th>
                                    <th>KM</th>
                                    <th>Local</th>
                                    <th>Dias Est.</th>
                                    <th>Valor</th>
                                    <th>Status/Qtd</th>
                                    <th>Ação</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaEstoque"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="sec-solicitacao" class="page-section">
                <div class="wizard-container paper-style">

                    <div class="wizard-progress">
                        <div class="step step-1 active"><span>1</span> Dados & CEP</div>
                        <div class="line line-1"></div>
                        <div class="step step-2"><span>2</span> Documentação</div>
                        <div class="line line-2"></div>
                        <div class="step step-3"><span>3</span> Pagamento</div>
                    </div>

                    <div class="wizard-step active" id="sol-step1">
                        <div class="sol-block highlight-block">
                            <h4>Veículo Selecionado</h4>
                            <div class="form-grid-3">
                                <div class="ig"><label>Modelo</label><input type="text" id="solModelo" readonly
                                        class="bg-gray bold"></div>
                                <div class="ig"><label>Placa</label><input type="text" id="solPlaca" readonly
                                        class="bg-gray bold"></div>
                                <div class="ig"><label>Valor (R$)</label><input type="text" id="solValor" readonly
                                        class="bg-gray bold text-blue"></div>
                            </div>
                        </div>

                        <div class="sol-block">
                            <h4>Dados do Cliente</h4>
                            <div class="form-grid-2">
                                <div class="ig full"><label>Nome Completo *</label><input type="text" id="cliNome">
                                </div>
                                <div class="ig"><label>CPF *</label><input type="text" id="cliCPF"
                                        placeholder="000.000.000-00" maxlength="14"></div>
                                <div class="ig"><label>RG</label><input type="text" id="cliRG"></div>
                                <div class="ig"><label>Email</label><input type="email" id="cliEmail"></div>
                                <div class="ig"><label>Telefone *</label><input type="text" id="cliTel"></div>
                            </div>
                        </div>

                        <div class="sol-block mg-top">
                            <h4>Endereço (Busca Automática)</h4>
                            <div class="form-grid-3" style="align-items: flex-end;">
                                <div class="ig"><label>CEP *</label><input type="text" id="endCEP"
                                        placeholder="00000-000" maxlength="9"></div>
                                <div class="ig" style="flex: 0 0 auto;"><button class="btn-secondary" type="button"
                                        onclick="buscarCEP()"><i class="fa-solid fa-search"></i> Buscar</button></div>
                            </div>
                            <div class="form-grid-3 mg-top">
                                <div class="ig full"><label>Logradouro</label><input type="text" id="endRua"
                                        class="bg-gray" readonly></div>
                                <div class="ig"><label>Número *</label><input type="text" id="endNum"></div>
                                <div class="ig"><label>Bairro</label><input type="text" id="endBairro" class="bg-gray"
                                        readonly></div>
                                <div class="ig"><label>Cidade/UF</label><input type="text" id="endCidade"
                                        class="bg-gray" readonly></div>
                            </div>
                        </div>

                        <div class="wizard-footer">
                            <button class="btn-secondary" onclick="navegar('sec-estoque')">Cancelar</button>
                            <button class="btn-primary" onclick="proximoPasso(2)">Continuar <i
                                    class="fa-solid fa-arrow-right"></i></button>
                        </div>
                    </div>

                    <div class="wizard-step" id="sol-step2">
                        <div class="docs-container" style="justify-content: center;">
                            <div class="doc-preview contract-theme" style="max-width: 800px; width: 100%;">
                                <div class="doc-header">
                                    <h2>CONTRATO DE COMPRA E VENDA DE VEÍCULO</h2>
                                    <p style="font-size: 0.9rem; font-weight: normal; text-transform: none;">INSTRUMENTO
                                        PARTICULAR</p>
                                </div>
                                <div id="contractBody" class="doc-body">
                                </div>
                                <div class="signatures">
                                    <div class="sig-line">
                                        <span id="sigVendedorName">FACILITA VEÍCULOS LTDA</span><br>
                                        <small>VENDEDOR</small>
                                    </div>
                                    <div class="sig-line">
                                        <span id="sigClienteName">CLIENTE</span><br>
                                        <small>COMPRADOR</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="wizard-footer">
                            <button class="btn-secondary" onclick="proximoPasso(1)">Voltar</button>
                            <button class="btn-primary" onclick="proximoPasso(3)">Confirmar Contrato <i
                                    class="fa-solid fa-arrow-right"></i></button>
                        </div>
                    </div>

                    <div class="wizard-step" id="sol-step3">
                        <div class="sol-block">
                            <h4>Forma de Pagamento</h4>
                            <div class="form-grid-2">
                                <div class="ig"><label>Modalidade</label>
                                    <select id="pgForma">
                                        <option>À Vista (PIX)</option>
                                        <option>Financiamento Bancário</option>
                                        <option>Cartão de Crédito</option>
                                    </select>
                                </div>
                                <div class="ig"><label>Banco/Financeira</label><input type="text" id="pgBanco"></div>
                                <div class="ig"><label>Valor de Entrada (R$)</label><input type="number" id="pgEntrada"
                                        value="0"></div>
                            </div>
                        </div>

                        <div class="sol-block">
                            <h4>Moto de Entrada (Troca)</h4>
                            <div class="form-grid-3">
                                <div class="ig"><label>Placa</label><input type="text" id="trocaPlaca"></div>
                                <div class="ig"><label>Modelo</label><input type="text" id="trocaModelo"></div>
                                <div class="ig"><label>Valor Avaliado (R$)</label><input type="number" id="trocaValor"
                                        value="0"></div>
                            </div>
                        </div>

                        <div class="sol-block">
                            <h4>Detalhes Finais</h4>
                            <div class="ig full"><label>Observações da Negociação</label><textarea id="negociacaoObs"
                                    rows="3"></textarea></div>
                            <div class="form-grid-2 mg-top">
                                <div class="ig"><label>Captação (Origem)</label>
                                    <select id="solCaptacao">
                                        <option>Loja Presencial</option>
                                        <option>WhatsApp</option>
                                        <option>Instagram/Facebook</option>
                                        <option>Indicação</option>
                                    </select>
                                </div>
                                <div class="ig"><label>Vendedor Responsável</label><input type="text" id="solVendedor"
                                        readonly class="bg-gray"></div>
                            </div>
                        </div>

                        <div class="wizard-footer">
                            <button class="btn-secondary" onclick="proximoPasso(2)">Voltar</button>
                            <button class="btn-success full-width-btn" onclick="finalizarVendaWizard()">CONCLUIR VENDA E
                                ENVIAR <i class="fa-solid fa-check"></i></button>
                        </div>
                    </div>

                </div>
            </section>

            <section id="sec-historico" class="page-section">
                <div class="panel-box">
                    <h3>Minhas Vendas Recentes</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Veículo</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>Ação</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaMinhasVendas"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="sec-financeiro" class="page-section">

                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon green"><i class="fa-solid fa-arrow-trend-up"></i></div>
                        <div class="kpi-info">
                            <small>Entradas (Vendas Concluídas)</small>
                            <h3>R$ <span id="finEntradas">0</span></h3>
                            <span class="trend-up"><i class="fa-solid fa-caret-up"></i> Caixa Real</span>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="kpi-icon red" style="background: #ffebee; color: #d32f2f;"><i
                                class="fa-solid fa-arrow-trend-down"></i></div>
                        <div class="kpi-info">
                            <small>Saídas (Custo de Estoque)</small>
                            <h3>R$ <span id="finSaidas">0</span></h3>
                            <span class="trend-down" style="color:#d32f2f">Investimento Total</span>
                        </div>
                    </div>

                    <div class="kpi-card highlight-profit">
                        <div class="kpi-icon blue"><i class="fa-solid fa-wallet"></i></div>
                        <div class="kpi-info">
                            <small>Balanço (Lucro Estimado)</small>
                            <h3>R$ <span id="finLucroLiquido">0</span></h3>
                            <small style="color:#555">Margem: <span id="finMargem">0%</span></small>
                        </div>
                    </div>

                    <div class="kpi-card" style="border: 1px solid #ff9800; background: #fff3e0;">
                        <div class="kpi-icon orange"><i class="fa-solid fa-clock"></i></div>
                        <div class="kpi-info">
                            <small>Pendente de Aprovação (Leads)</small>
                            <h3>R$ <span id="finPendente">0</span></h3>
                            <small>30+ Solicitações na mesa</small>
                        </div>
                    </div>
                </div>

                <div class="panel-box">
                    <div class="panel-header">
                        <h3><i class="fa-solid fa-list-check"></i> Auditoria de Vendas (Solicitações Pendentes)</h3>
                        <div style="display:flex; gap:10px;">
                            <button class="btn-secondary btn-small" onclick="alert('Relatório baixado!')"><i
                                    class="fa-solid fa-download"></i> Baixar Relatório</button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Vendedor</th>
                                    <th>Cliente</th>
                                    <th>Veículo / Placa</th>
                                    <th>Valor Venda</th>
                                    <th>Pagamento</th>
                                    <th>Status</th>
                                    <th>Ação</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaLeadsFin">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="sec-equipe" class="page-section">
                <div class="panel-box">
                    <div class="panel-header">
                        <h3>Colaboradores</h3>
                        <button class="btn-primary">+ Novo</button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Matrícula</th>
                                <th>Nome</th>
                                <th>Cargo</th>
                                <th>Status</th>
                                <th>Supervisor</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </section>

        </main>
    </div>

    <div id="modalAuditoria" class="modal-overlay-inner" style="display: none;">
        <div class="modal-box large-modal"
            style="width: 95%; max-width: 1000px; height: 95vh; display:flex; flex-direction:column;">
            <div class="modal-header">
                <h4 id="modalAuditTitle">Auditoria de Venda - Conferência Completa</h4>
                <button class="close-btn" onclick="fecharModalAuditoria()"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <div class="modal-body" style="background: #f4f6f9; padding: 20px; overflow-y: auto;">

                <div class="sol-block"
                    style="background:white; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                    <h4
                        style="color:var(--primary); border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
                        1. Dados do Cliente e Endereço</h4>
                    <div class="form-grid-2">
                        <div class="ig"><label>Nome Completo</label><input type="text" id="auditNome" readonly
                                class="bg-gray"></div>
                        <div class="ig"><label>CPF</label><input type="text" id="auditCPF" readonly class="bg-gray">
                        </div>
                        <div class="ig"><label>RG</label><input type="text" id="auditRG" readonly class="bg-gray"></div>
                        <div class="ig"><label>Email</label><input type="text" id="auditEmail" readonly class="bg-gray">
                        </div>
                        <div class="ig"><label>Telefone</label><input type="text" id="auditTel" readonly
                                class="bg-gray"></div>
                        <div class="ig full"><label>Endereço Completo</label><input type="text" id="auditEnd" readonly
                                class="bg-gray"></div>
                    </div>
                </div>

                <div class="sol-block"
                    style="background:white; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                    <h4
                        style="color:var(--primary); border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
                        2. Condições de Pagamento e Troca</h4>
                    <div class="form-grid-3">
                        <div class="ig"><label>Modalidade</label><input type="text" id="auditPgForma" readonly
                                class="bg-gray bold text-blue"></div>
                        <div class="ig"><label>Banco/Financeira</label><input type="text" id="auditPgBanco" readonly
                                class="bg-gray"></div>
                        <div class="ig"><label>Valor Entrada</label><input type="text" id="auditPgEntrada" readonly
                                class="bg-gray"></div>

                        <div class="ig"><label>Veículo Troca (Modelo)</label><input type="text" id="auditTrocaModelo"
                                readonly class="bg-gray"></div>
                        <div class="ig"><label>Placa Troca</label><input type="text" id="auditTrocaPlaca" readonly
                                class="bg-gray"></div>
                        <div class="ig"><label>Valor Avaliação Troca</label><input type="text" id="auditTrocaValor"
                                readonly class="bg-gray"></div>
                    </div>
                </div>

                <div class="sol-block"
                    style="background:white; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                    <h4
                        style="color:var(--primary); border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
                        3. Documentação Anexa</h4>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="flex: 1;">
                            <label style="font-weight:bold; margin-bottom:5px; display:block;">Anexar Comprovante / Doc
                                (PDF/IMG):</label>
                            <input type="file" id="auditArquivo"
                                style="padding: 10px; border: 1px dashed #ccc; width: 100%;">
                        </div>
                        <button class="btn-secondary btn-small" onclick="alert('Documento visualizado (Simulação)!')"><i
                                class="fa-solid fa-eye"></i> Visualizar Anexo</button>
                    </div>
                </div>

                <div class="sol-block"
                    style="background:white; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                    <h4
                        style="color:var(--primary); border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
                        4. Conferência do Contrato (Minuta)</h4>
                    <div class="doc-preview contract-theme"
                        style="width: 100%; border:1px solid #ddd; padding:40px; transform: scale(0.95); transform-origin: top center;">
                        <div class="doc-header">
                            <h2>CONTRATO DE COMPRA E VENDA DE VEÍCULO</h2>
                            <p style="font-size: 0.9rem; font-weight: normal; text-transform: none;">INSTRUMENTO
                                PARTICULAR</p>
                        </div>
                        <div id="auditContractBody" class="doc-body">
                        </div>
                        <div class="signatures">
                            <div class="sig-line">
                                <span>FACILITA VEÍCULOS LTDA</span><br>
                                <small>VENDEDOR</small>
                            </div>
                            <div class="sig-line">
                                <span id="auditSigCliente">CLIENTE</span><br>
                                <small>COMPRADOR</small>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="modal-footer"
                style="justify-content: space-between; background: #fff; border-top: 2px solid #eee;">
                <button class="btn-danger" onclick="reprovarVendaFinanceiro()">REPROVAR / CORRIGIR</button>
                <button class="btn-success" onclick="confirmarAprovacaoFinanceiro()">APROVAR VENDA DEFINITIVA <i
                        class="fa-solid fa-check-double"></i></button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>
